**Quiver Visual Functions** 是 Palantir Foundry Quiver 应用中一项强大的功能，允许用户将一系列用于数据转换或计算的**卡片（Cards）封装成一个可复用的函数** [1], [2]。

以下是关于 Quiver Visual Functions 的详细介绍，包括其核心价值、创建流程、使用方式及实际应用场景：

### 1. 核心价值与逻辑
Quiver 的基本构建单元是“卡片”，而 Visual Functions 则提供了对这些逻辑块进行打包的能力 [2]。
*   **逻辑复用：** 团队可以分享复杂的计算逻辑（如特定的业务指标公式），无需每次从头开始或重复劳动 [2]。
*   **降低错误率：** 通过封装经过验证的计算步骤，可以减少手动重复操作带来的风险，确保全组织范围内指标的一致性 [3]。
*   **简化流程：** 对于需要对多个数据集或对象子集执行相同分析的情况，Visual Functions 能极大简化工作流 [4]。

### 2. 创建流程
创建一个 Visual Function 通常包含以下步骤，以“净推荐值（NPS）计算器”为例 [5]：
*   **构建基础逻辑：** 首先在 Quiver 中使用标准卡片完成所有的分析步骤。例如，从一个对象集开始，经过过滤（Filter）、数值聚合（Numeric Aggregation）以及数值公式（Numeric Formula）计算得出最终结果 [6], [7], [8]。
*   **定义函数：** 在侧边栏的“函数（Functions）”菜单中选择“创建新函数” [9]。
*   **配置输入与输出：**
    *   **输出（Output）：** 选择分析路径中的最终结果卡片（如 NPS 计算结果卡片） [9]。
    *   **输入（Input）：** 选择逻辑的起点，通常是一个基础对象集（Base Object Set）。这使得该函数具有通用性，可以接收不同的输入数据 [10]。
*   **发布（Publish）：** 完成配置后点击发布，该函数即可在当前或其他 Quiver 分析中使用 [10]。

### 3. 使用方式
发布后的 Visual Function 会出现在卡片搜索列表中。
*   **调用卡片：** 用户可以搜索并添加“**Visual Function Metric**”卡片（或根据返回类型选择 Boolean, String, Date/Time 等类型的函数卡片） [10], [11]。
*   **配置参数：** 选择对应的函数后，用户只需提供所需的输入（例如某个特定的对象子集），函数就会自动执行内部的所有转换和计算步骤并直接返回结果 [10], [3]。

### 4. 实际应用示例：NPS 计算
来源中详细展示了如何利用 Visual Function 简化不同年龄段客户的 NPS 计算 [4]：
*   **传统方式：** 需要为“20岁以下”、“20-50岁”、“50-70岁”以及“70岁以上”四个群体分别手动建立复杂的过滤和计算卡片组。
*   **函数方式：** 只需建立一个名为“NPS Calculator”的 Visual Function。然后为每个年龄群体添加一个“Visual Function Metric”卡片，并将对应的年龄过滤结果作为输入。这样，所有的计算逻辑（分类 promoter/detractor、求比例、代入公式）都会自动完成，极大提高了分析效率 [4], [12]。

### 5. 扩展集成
Quiver Visual Functions 不仅限于 Quiver 内部。封装了这些函数的 **Quiver Dashboard** 可以作为模板嵌入到 **Workshop** 模块中，甚至可以用于生成 **Notepad** 文档报告，实现从底层逻辑到前端展示的动态联动 [1], [13]。
