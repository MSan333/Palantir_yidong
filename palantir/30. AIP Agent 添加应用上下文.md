在 Palantir Foundry 的 AIP Agent Studio 中，**应用状态（Application State）**是代理与其部署环境（如 Workshop 应用程序）进行通信的关键机制 [1, 2]。它允许代理从 Workshop 中**继承并读取变量**，从而根据实时上下文提供个性化的对话体验 [1, 3]。

以下是为 AIP Agent 添加应用上下文（应用状态）的详细步骤：

### 1. 在 Agent Studio 中配置变量
*   **创建变量：** 在代理配置页面左侧导航至 **“Application State”** 模块，点击 “Add application variable” [4, 5]。
*   **选择类型：** 开发者可以选择 **String（字符串）** 变量（例如用于传递用户名、用户 ID 或电子邮件）或 **Object Set（对象集）** 变量（例如传递过滤后的特定数据子集）[4-6]。
*   **开启可见性：** 必须确保开启 **“LLM can see value”** 开关，否则大语言模型将无法在推理过程中访问或引用这些变量值 [4, 5]。

### 2. 在系统提示词（System Prompt）中引用
*   **触发引用：** 在系统提示词编辑框中，通过输入**正斜杠（`/`）**来呼出并引用已定义的变量 [7, 8]。
*   **定义行为逻辑：** 开发者需要在提示词中明确指示模型如何使用这些上下文 [9, 10]。例如，可以写道：“使用 `/current_user_name` 变量友好地称呼用户”，或者“根据 `/memories_for_current_user` 中的历史偏好生成建议” [9-11]。

### 3. 调试应用状态
*   **模拟测试：** 在正式部署之前，可以点击界面右上角的 **“X” 图标（Debug application state）** [7, 10]。
*   **验证响应：** 手动为定义的变量输入测试值（如输入姓名 “Gina”），然后发送消息测试代理是否能够正确接收该信息并根据其内容调整回复 [7, 12]。

### 4. 在 Workshop 中进行集成与变量绑定
一旦代理配置完成并发布，就需要在其部署的 Workshop 应用中完成变量的闭环映射：
*   **部署组件：** 在 Workshop 中添加 **AIP Agent Interactive Widget（交互式组件）**，并选择已配置应用状态的代理版本 [13, 14]。
*   **定义 Workshop 变量：** 
    *   使用 **Multipass Attribute** 变量自动获取当前登录用户的属性，如 `user_id`、`email` 或 `given name` [3, 6, 13]。
    *   也可以定义动态的 **Object Set 变量**，例如根据 Workshop 的过滤器筛选出仅属于当前用户的特定对象记录 [5, 6]。
*   **完成映射绑定：** 在组件的配置面板下，将代理预设的变量名（例如 `current_user_name`）映射到 Workshop 中对应的动态变量上 [13, 15]。

### 核心价值与应用场景
通过这种架构，AIP Agent 能够实现**响应式互动** [3]。例如，当用户在应用中切换不同的数据记录时，代理能实时获取当前记录的细节；或者通过传递用户 ID，使代理具备**跨会话记忆**的能力，在全新的聊天窗口中仍能记住用户的个性化偏好 [2, 3, 16]。这使 AIP 代理能真正融入组织的运营工作流，而不仅仅是一个静态的问答工具 [3, 17]。
