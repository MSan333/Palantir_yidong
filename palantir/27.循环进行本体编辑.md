在 Palantir Foundry 的 **AIP Logic** 中，**循环（Looping）** 功能不仅可以用于数据转换，还可以专门用于执行**本体编辑（Ontology Edits）**。这使得开发者能够摄取一个列表，并为列表中的每一个元素触发特定的操作（如创建或修改对象），从而实现批量化的本体维护 [1, 2]。

以下是使用循环进行本体编辑的详细介绍及实施流程：

### 1. 核心机制
*   **逐项处理：** 循环块允许针对列表中的每个项目运行一个“微型函数” [3, 4]。
*   **触发操作：** 在循环内部，你可以调用已定义的**操作类型（Action Type）**。在每次迭代中，系统会根据当前元素的值填充操作参数 [5, 6]。
*   **批量结果：** 运行结束后，系统会生成一组**拟议的本体编辑（Proposed Ontology Edits）**。例如，如果输入数组包含 3 个元素，循环将产生 3 个独立的对象创建或修改提案 [5, 6]。

### 2. 前置准备：本体建模
在构建逻辑之前，必须在**本体管理器（Ontology Manager）**中完成以下配置：
*   **对象类型：** 创建一个用于接收数据的对象类型（例如“动物”或“问题”对象） [7, 8]。
*   **启用编辑：** 必须在数据源设置中开启 **“Allow Edits”**，否则 AIP Logic 无法通过操作回写数据 [9, 10]。
*   **操作类型：** 定义一个操作（如 `Create Animal`），并确保其参数（如 `Animal Type`）与你计划循环的数据项匹配 [4, 11]。

### 3. AIP Logic 中的配置步骤
1.  **定义输入数组：** 创建一个 `Array` 类型的函数输入（例如字符串数组 `["cat", "fish", "bat"]`），因为数组是转换为循环所需列表的最便捷方式 [12]。
2.  **添加循环块：** 在控制流（Control Flow）中选择 `Loop` 块。选择输入数组时，系统会自动添加一个 **“Array to literal list”** 转换块，将数组变为可遍历的字面量列表 [3, 12]。
3.  **配置元素变量：** 为了提高可读性，建议将循环内的“元素（Element）”重命名为更具业务意义的名称（如 `animal_type`） [3, 4]。
4.  **插入操作工具：** 在循环体内部，搜索并添加预先定义好的本体操作（Action）。
5.  **映射参数：** 这是关键步骤。在操作表单中，不要手动输入固定值，而是引用循环当前的 **“元素（Element）”** 或其属性。例如，将 `animal_type` 变量绑定到操作的 `Type` 参数上 [6]。

### 4. 预览、发布与部署
*   **阶段性预览（Staging）：** 在 AIP Logic 界面运行预览时，**本体编辑并不会真正执行**。你看到的是“拟议编辑”，这允许你在正式部署前验证逻辑是否正确 [6, 13]。
*   **发布函数：** 完成逻辑构建后，保存并发布函数，并将其绑定到特定的本体 [6]。
*   **创建封装操作：** 发布的 AIP Logic 函数需要通过一个 **“由函数支持的操作（Function-backed Action）”** 来调用。这个封装好的操作可以在 **Workshop** 应用中通过按钮触发 [14, 15]。
*   **实时效果：** 当用户在 Workshop 中点击按钮并提交一个包含多个项的列表时，该操作会触发 AIP Logic 循环，**一次性在本体中创建或更新多个对象** [16]。

### 5. 典型应用场景示例
*   **批量知识入库：** 将一段长文本切分为多个片段（Chunks），通过循环为每个片段计算向量嵌入，并同时创建多个“知识块”对象 [17-19]。
*   **自动化资产登记：** 接收一个设备列表数组，循环调用创建操作，在系统中为每台设备生成唯一的 ID 和对应的本体记录 [5, 16]。
*   **批量状态更新：** 对一组选定的故障工单进行循环处理，根据 AI 的判断批量修改它们的优先级或分配状态 [20, 21]。

通过这种方式，AIP Logic 的循环功能将原本需要手动逐个处理的繁琐任务转化为一个自动化的、可扩展的本体管理工作流 [16]。
