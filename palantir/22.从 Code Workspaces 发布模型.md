在 Palantir Foundry 中，从 **Code Workspaces**（如 Jupyter Notebooks）训练并发布机器学习模型是一种结合了灵活开发工具与平台原生运维能力的强大工作流 [1]。

以下是从 Code Workspaces 发布模型的详细步骤：

### 1. 模型训练与准备
*   **环境配置：** 开发者可以在 Jupyter Notebook 中使用熟悉的库进行开发 [2, 3]。除了标准的数据科学工具（如 `pandas`、`scikit-learn`），还必须安装 **`palantir-models-serializers`** 库，该库会自动安装核心的 `palantir-models` 依赖项 [3, 4]。
*   **特征工程与拟合：** 在工作区中导入数据，进行特征选择（如区分数值特征和分类特征）并定义训练管道 [4, 5]。通常使用 **管道链式调用（Pipeline Chaining）** 将预处理步骤（如归一化、独热编码）与回归器（如梯度提升回归树）封装在一起 [6]。

### 2. 创建模型资源
*   **初始化模型对象：** 在 Code Workspaces 的“模型（Models）”标签页中，点击 **“Add model”** 创建一个新的模型资源，并将其保存到项目的指定文件夹中 [7, 8]。
*   **生成适配器：** 创建模型资源后，系统会生成一个 **模型适配器文件（Model Adapter）** 模板 [8]。适配器类似于模型的 **API 定义**，它指示 Foundry 如何加载模型、进行序列化、定义输入（要求的列名和类型）以及预测（Predict）方法的具体逻辑 [8, 9]。

### 3. 封装与发布（Publishing）
*   **编写适配器逻辑：** 开发者需要根据训练好的模型填充适配器模板。适配器必须明确定义 **模型输入架构**（Input schema）和包含预测值列的 **输出架构** [9, 10]。
*   **执行发布代码：** 在 Notebook 中使用系统提供的代码片段，将训练好的“最佳模型”对象与适配器类绑定 [9, 10]。通过调用 **`model_output.publish`** 函数，将包装后的模型上传到 Foundry 平台 [10]。发布成功后，系统会显示加载进度条，并最终生成一个带有特定输入输出定义的模型版本 [10]。

### 4. 后续部署与应用
*   **启动在线部署：** 发布完成后，可以在模型资源页面点击 **“Start deployment”** 启动模型服务 [11]。
*   **集成到应用程序：** 发布后的模型可以被进一步提交到 **建模目标（Modeling Objectives）** 进行性能评估，或者包装在 **Typescript 函数** 中，以便在 **Workshop** 等面向用户的应用程序中实时调用并生成预测消息 [11-13]。

通过这种方式，Code Workspaces 让数据科学家既能保留本地化的编码习惯，又能确保模型作为受控、可版本化且可运维的资产集成到组织的数据基础中 [1, 7]。
