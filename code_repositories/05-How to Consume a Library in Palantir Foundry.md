在 Palantir Foundry 中使用（Consume）已发布的库，主要涉及在代码仓库中添加依赖、重构代码引用以及解决环境依赖冲突等步骤。根据提供的资料，以下是详细的操作流程：
1. 准备工作与创建分支 在开始引用库之前，首先需要定位代码中现有的本地函数（例如通过搜索函数名），以便后续替换。
• 创建新分支：通常 master 分支会被锁定，导致无法直接修改配置。如果你发现“添加库”（Add library）按钮处于禁用状态，你需要先创建一个新分支（例如命名为 consume aviation library），此时按钮即会被启用。
2. 添加库依赖
• 搜索与添加：进入侧边栏的“Libraries”（库）选项卡，搜索你之前发布或需要的库名称（例如 aviation cleaning library）。点击该库并选择添加。
• 确认配置文件：添加成功后，系统会自动修改 meta.yaml 文件（文件状态会变黄提示已编辑）。你可以检查该文件，确认在依赖列表中（如第 23 行）已经包含了目标库。完成确认后，提交（Commit） 更改。
3. 代码重构与引用
• 导入函数：在代码文件中，你需要从库的根包（root package）中导入所需的函数。例如，如果根包名为 cleaner，可以使用如下语句导入： from cleaner.function import data_asset_pass_flattener。
• 清理旧代码：为了避免冲突（collide），必须删除原文件中本地定义的同名函数代码。完成修改后再次提交代码。
4. 处理 CI 检查与环境版本冲突 提交代码后，CI（持续集成）检查会自动运行。如果检查失败，需要查看日志信息。
• Python 版本不匹配：一个常见错误是项目当前的 Python 版本与库要求的版本不一致。例如，项目可能使用的是 Python 3.6，而库需要 Python 3.8。
• 升级版本：此时需要回到 meta.yaml 文件中，将 Python 版本依赖修改为符合要求的版本（如 3.8.*），然后再次提交。
5. 性能提示 在等待 CI 检查时需要注意，每当修改 meta.yaml 或 conda.yaml 等涉及 Python 依赖的配置时，Conda 都需要重新解析包的依赖树（re-resolve the package dependency tree），这可能会显著增加 CI 检查的时间。如果遇到检查时间过长的问题，可以尝试在 Conda 配方中通过固定版本号（pinning versions）来优化。
一旦 CI 检查通过且代码中没有报错，即表示库已成功导入并可正常使用。