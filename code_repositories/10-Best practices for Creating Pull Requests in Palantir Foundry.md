根据 Palantir Developers 提供的关于 Code Repositories 的最佳实践指南，在 Palantir Foundry 中创建 Pull Request (PR) 的核心目标是降低意外破坏生产环境的风险。
以下是基于该视频教程整理的详细最佳实践流程：
1. 准备阶段：在创建 PR 之前
在点击创建 PR 按钮之前，建议进行以下准备工作，以减少后续的冲突和错误：
• 确保分支与 Master 同步： 在提交 PR 前，先检查你的分支是否包含 Master 分支的最新更改。建议点击 "Merge" 并选择 "Merge from Branch master"。如果忽略这一步，PR 创建后可能会出现合并冲突，你还是得花时间去解决。
• 自我代码审查： 通读你所做的所有更改，确保代码逻辑合理。特别要注意删除此前开发过程中添加的测试语句或不再需要的临时代码。
2. PR 创建阶段：填写标题与描述
一个高质量的 PR 应该包含清晰的信息，方便审核者（Reviewer）理解意图和验证结果。
• 使用描述性的标题： 给 PR 起一个能准确反映更改内容的名称，例如“将列名 A 重命名为 B 并替换路径 logic”，而不是模糊的命名。
• 完善 PR 描述（核心清单）： 视频建议在 PR 描述中包含一份检查清单（Checklist），涵盖以下五个方面：
    1. 变更摘要：用简短的要点（Bullet points）列出具体的更改内容，让审核者快速了解 PR 的目的。
    2. 构建（Build）链接：提供一个链接，证明你修改的数据集以及所有下游受影响的数据集都能成功构建。这证明了你的更改不仅自身没问题，也不会破坏后续的管道。
        ▪ 提示：如果因为重命名列等操作导致下游构建失败，需要修复下游代码，重新提交并更新构建链接。
    3. 结构对比（Compare to Master）：对于关键数据集，添加一个与 Master 分支对比的链接。审核者可以通过此链接查看 Schema 变更、行数（Row count）和空值百分比（Null percentage）。确保行数稳定且没有意外的空值激增。
    4. 内容深度验证（Contour Analysis）：对于复杂的业务逻辑变更，仅仅检查结构是不够的。建议创建一个 Contour 分析，筛选特定案例（如特定的 ID），并排展示 "Master 分支" 和 "当前开发分支" 的数据内容。将此分析添加到仪表板（Dashboard）并将链接放入 PR 描述中，以证明具体数据的计算逻辑是正确的。
    5. 后续行动（Follow-ups）：明确列出合并代码后需要执行的操作。例如：更改 Schedule、在 Ontology 编辑器中重新连接列、或更新 Workshop 应用程序等。如果没有后续操作，也明确注明。
3. 审核与合并阶段
• 使用 "Work in Progress" 标记： 在填补上述清单（如等待构建完成、添加链接）的过程中，建议给 PR 加上 "Work in Progress" 的前缀，表明尚未准备好接受审核。待所有检查项完成后，再移除该标记并添加审核者。
• 设置审核权限： 建议配置分支设置，要求必须通过自动检查（Checks passing）且至少获得一组管理员的批准才能合并。
4. 合并后的操作
PR 被批准并合并后，流程尚未结束：
• 在 Master 上构建： 等待 Master 分支的检查完成，并手动构建数据集（或者等待下一次预定的 Schedule 运行），以确保更改在生产环境中生效。
• Ontology 同步： 如果是同步到 Ontology 的数据集，必须等待同步（Sync）完成，更改才会反映在 Object Explorer、Quiver 或 Workshop 等消费端应用中。
总结
遵循这一流程的核心在于：不要只依赖代码层面的正确性，还要通过构建链接、结构对比和具体数据分析来提供“证据”，证明更改是安全的。
